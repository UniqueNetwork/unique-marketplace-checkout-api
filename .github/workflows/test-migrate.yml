
name: Test-migrates

on:
  push:
    branches: [ "test-migrates" ]
  pull_request:
    branches: [ "test-migrates" ]
  workflow_dispatch:

jobs:
  migrate:
    name: Migrate DB
    runs-on: self-hosted
    environment: dev
    steps:
      - name: Migrate Postgres
        run: docker run --rm --network=${{ secrets.DOCKER_NETWORK }} -e POSTGRES_URL="postgres://not:${{ secrets.DB_PASSWORD }}@${{ secrets.DB_HOST }}:5432/${{ secrets.DB_NAME }}" ghcr.io/uniquenetwork/unique-marketplace-checkout-api/checkout-market-back:dev npx typeorm migration:run -d dist/database/connection-options.js
